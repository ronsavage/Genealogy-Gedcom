<html><head><title>The Genealogy::Gedcom Namespace</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
<link rel="stylesheet" type="text/css" title="pod_stylesheet" href="/assets/css/local/pod.css">

</head>
<body class='pod'>
<!--
  generated by Local::Pod::Simple::HTML v1.02,
  using Pod::Simple::PullParser v3.16,
  under Perl v5.012002 at Tue Aug 16 06:24:09 2011 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Local::Pod::Simple::HTML, and/or subclassing Local::Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Local::Pod::Simple::HTML for advice.
   See 'perldoc Local::Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<a name='___top' class='dummyTopAnchor' ></a>
<h1><div class="toc_title">The Genealogy::Gedcom Namespace</div></h1>
<h3><div class="toc_toc">Table of contents</div></h3>
<table align="center" summary = "Table of Contents">
<tr><td align="center"><a href="#The_Genealogy%3A%3AGedcom_Namespace">The Genealogy::Gedcom Namespace</a></td></tr>
<tr><td align="center"><a href="#FAQ">FAQ</a></td></tr>
<tr><td align="center"><a href="#Which_version_of_GEDCOM_is_the_default_for_these_modules%3F">Which version of GEDCOM is the default for these modules?</a></td></tr>
<tr><td align="center"><a href="#Where_does_all_this_leave_Paul_Johnson%27s_Gedcom.pm%3F">Where does all this leave Paul Johnson&#39;s Gedcom.pm?</a></td></tr>
<tr><td align="center"><a href="#What_will_the_new_modules_do%3F">What will the new modules do?</a></td></tr>
<tr><td align="center"><a href="#Yes%2C_all_well_and_good%2C_but_what%27s_the_point_of_re-writing_Gedcom.pm%3F">Yes, all well and good, but what&#39;s the point of re-writing Gedcom.pm?</a></td></tr>
<tr><td align="center"><a href="#Why_do_states_in_that_STT_appear_to_be_doubled%3F">Why do states in that STT appear to be doubled?</a></td></tr>
<tr><td align="center"><a href="#How_do_these_new_modules_handle_non-standard_tags%3F">How do these new modules handle non-standard tags?</a></td></tr>
<tr><td align="center"><a href="#What_about_extensions_to_GEDCOM_5.5.1%3F">What about extensions to GEDCOM 5.5.1?</a></td></tr>
<tr><td align="center"><a href="#References">References</a></td></tr>
<tr><td align="center"><a href="#The_Gedcom_Mailing_List">The Gedcom Mailing List</a></td></tr>
</table>
<h1><a class='u' href='#___top' title='click to go to top of document'
name="The_Genealogy::Gedcom_Namespace"
>The Genealogy::Gedcom Namespace</a></h1>

<p>This document is about the new set of modules I (Ron Savage) am writing (2011-08-12):</p>

<dl>
<dt><a name="A)_Genealogy::Gedcom"
>A) <a href="http://metacpan.org/module/Genealogy::Gedcom" class="podlinkpod"
>Genealogy::Gedcom</a></a></dt>

<dd>
<dt><a name="B)_Genealogy::Gedcom::Reader"
>B) <a href="http://metacpan.org/module/Genealogy::Gedcom::Reader" class="podlinkpod"
>Genealogy::Gedcom::Reader</a></a></dt>

<dd>
<dt><a name="C)_Genealogy::Gedcom::Reader::Lexer"
>C) <a href="http://metacpan.org/module/Genealogy::Gedcom::Reader::Lexer" class="podlinkpod"
>Genealogy::Gedcom::Reader::Lexer</a></a></dt>

<dd>
<dt><a name="D)_Genealogy::Gedcom::Reader::Lexer::DFA"
>D) <a href="http://metacpan.org/module/Genealogy::Gedcom::Reader::Lexer::DFA" class="podlinkpod"
>Genealogy::Gedcom::Reader::Lexer::DFA</a></a></dt>

<dd>
<dt><a name="E)_Genealogy::Gedcom::Reader::Parser"
>E) <a href="http://metacpan.org/module/Genealogy::Gedcom::Reader::Parser" class="podlinkpod"
>Genealogy::Gedcom::Reader::Parser</a></a></dt>

<dd>
<dt><a name="F)_Genealogy::Gedcom::Writer"
>F) <a href="http://metacpan.org/module/Genealogy::Gedcom::Writer" class="podlinkpod"
>Genealogy::Gedcom::Writer</a></a></dt>
</dl>

<p>The basic code,
and hence the (dir) structure,
of this set is copied directly from <a href="http://metacpan.org/module/Graph::Easy::Marpa" class="podlinkpod"
>Graph::Easy::Marpa</a>,
so yes,
the parser will use Marpa.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="FAQ"
>FAQ</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Which_version_of_GEDCOM_is_the_default_for_these_modules?"
>Which version of GEDCOM is the default for these modules?</a></h2>

<p>DRAFT Release 5.5.1,
in Ged551-5.pdf.
See <a href="http://metacpan.org/module/The Genealogy::Gedcom Namespace#References" class="podlinkpod"
>&#34;References&#34;</a> for downloading details.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Where_does_all_this_leave_Paul_Johnson&#39;s_Gedcom.pm?"
>Where does all this leave Paul Johnson&#39;s Gedcom.pm?</a></h2>

<p>People using that module should continue to use it indefinitely.</p>

<p>I do not see <a href="http://metacpan.org/module/Genealogy::Gedcom" class="podlinkpod"
>Genealogy::Gedcom</a> as being a drop-in replacement for Gedcom.pm.</p>

<p>Nevertheless,
if and when G::G reaches V 1.00 (what I call production quality),
it might be a consideration for new code,
since,
dealing with identical input,
they will obviously have a number of methods in common.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="What_will_the_new_modules_do?"
>What will the new modules do?</a></h2>

<dl>
<dt><a 
>A) <a href="http://metacpan.org/module/Genealogy::Gedcom" class="podlinkpod"
>Genealogy::Gedcom</a> is a dummy module,
which will one day have methods to directly manipulate data at the individual and family level.</a></dt>

<dd>
<p>The following modules all operate at a lower level.</p>

<dt><a name="B)_Genealogy::Gedcom::Reader_is_a_wrapper_which_calls_both_the_lexer_and_the_parser."
>B) <a href="http://metacpan.org/module/Genealogy::Gedcom::Reader" class="podlinkpod"
>Genealogy::Gedcom::Reader</a> is a wrapper which calls both the lexer and the parser.</a></dt>

<dd>
<dt><a name="C)_Genealogy::Gedcom::Reader::Lexer_is_called_by_Genealogy::Gedcom::Reader,_and_can_be_called_from_any_module."
>C) <a href="http://metacpan.org/module/Genealogy::Gedcom::Reader::Lexer" class="podlinkpod"
>Genealogy::Gedcom::Reader::Lexer</a> is called by <a href="http://metacpan.org/module/Genealogy::Gedcom::Reader" class="podlinkpod"
>Genealogy::Gedcom::Reader</a>,
and can be called from any module.</a></dt>

<dd>
<p>It reads the GEDCOM file,
and lexes it,
meaning it identifies tokens in the input stream,
but does not assign meaning to those tokens.
The paser assigns meaning to them.</p>

<p>Experts in the field are free to disagree with my casual definitions of lexing and parsing.</p>

<p>I call the GEDCOM file &#39;raw&#39; data,
so this CSV file is called &#39;cooked&#39;.
This terminology helps name some of the many command line options available.</p>

<p>Outputs supported by the lexer:</p>

<dl>
<dt><a name="o_A_RAM-based_array_(of_tokens),_to_be_passed_to_the_parser,_or_to_any_other_module."
>o A RAM-based array (of tokens),
to be passed to the parser,
or to any other module.</a></dt>

<dd>
<p>Note: In this array,
of type <a href="http://metacpan.org/module/Set::Array" class="podlinkpod"
>Set::Array</a>,
each element is a hashref with these key =&#62; value pairs:</p>

<pre>        count      =&#62; $myself -&#62; _count,
        data       =&#62; defined($field[2]) ? $field[2] : &#39;&#39;, # To allow for $field[2] eq &#39;0&#39;.
        level      =&#62; $field[0],
        line_count =&#62; $myself -&#62; line_count,
        tag        =&#62; $field[1],
        type       =&#62; $type,</pre>

<p>where @field = split(/\s+/, $input_record, 3).</p>

<p>The code reading the file removes leading and trailing spaces, and this usage of split handles indented GEDCOM files.</p>

<p>The removal of trailing spaces may cause inconvenience when the file deliberately contains a trailing space. See p 10 of the GEDCOM document, where it discusses the CONC and CONT tags. This means the removal of trailing spaces may be dropped from the code, or made optional.</p>

<pre>        count is the token count, 1 .. N. Hence it&#39;s just the array index + 1.
        data is &#39;20 Dec 1775&#39;, in the GEDCOM record &#39;2     DATE 20 Dec 1775&#39;.
        level is &#39;2&#39;, in that record.
        line_count is that record&#39;s line number within the input file. This helps identification of errors in the file.
        tag is &#39;DATE&#39;, within that record.
        type is the context of that record. If the parent of that record is &#39;BIRT&#39;, and BIRT&#39;s parent is &#39;0 @I1@ INDI&#39;, then type is &#39;individual&#39;.</pre>

<p>In fact, the record &#39;0 @I1@ INDI&#39;, and all its child records, have type &#39;individual&#39;.</p>

<p>I have to use $myself, since the DFA calls functions, and $self is not available within these functions.</p>

<p>In fact, <a href="http://metacpan.org/module/Set::FA::Element" class="podlinkpod"
>Set::FA::Element</a> calls these functions with only 1 parameter, the object of type <a href="http://metacpan.org/module/Set::FA::Element" class="podlinkpod"
>Set::FA::Element</a> itself.</p>

<p>So, $myself is a global variable within the lexer, and is a copy of $self, and in this way I can circumvent the fact the DFA only calls functions.</p>

<p>Lastly, another note on the &#39;count&#39; key. It is not the line number in the input stream because the code ignores (but still counts) blank lines.</p>

<dt><a name="o_A_CSV_file_(of_tokens)."
>o A CSV file (of tokens).</a></dt>

<dd>
<p>This file too can be passed to the parser, or to any other module.</p>

<p>By default, the CSV file is not produced.</p>

<dt><a name="o_A_pretty-printed_report_(of_tokens),_written_to_the_log."
>o A pretty-printed report (of tokens), written to the log.</a></dt>

<dd>
<p>A logger option can suppress this report.</p>

<p>The default logger is <a href="http://metacpan.org/module/Log::Handler" class="podlinkpod"
>Log::Handler</a>, whose default output goes to the screen.</p>
</dd>
</dl>

<p>To do its work, <a href="http://metacpan.org/module/Genealogy::Gedcom::Reader::Lexer" class="podlinkpod"
>Genealogy::Gedcom::Reader::Lexer</a> calls the next module.</p>

<dt><a 
>D) <a href="http://metacpan.org/module/Genealogy::Gedcom::Reader::Lexer::DFA" class="podlinkpod"
>Genealogy::Gedcom::Reader::Lexer::DFA</a>, where DFA stands for Discrete Finite Automaton (nick: State Machine). The latter module calls <a href="http://metacpan.org/module/Set::FA::Element" class="podlinkpod"
>Set::FA::Element</a>, a module which I did not write but which I now maintain.</a></dt>

<dd>
<p><a href="http://metacpan.org/module/Genealogy::Gedcom::Reader::Lexer" class="podlinkpod"
>Genealogy::Gedcom::Reader::Lexer</a> will perform some validation on the input tokens.</p>

<dt><a name="E)_Genealogy::Gedcom::Reader::Parser_is_also_called_by_Genealogy::Gedcom::Reader,_and_can_be_called_from_any_module."
>E) <a href="http://metacpan.org/module/Genealogy::Gedcom::Reader::Parser" class="podlinkpod"
>Genealogy::Gedcom::Reader::Parser</a> is also called by <a href="http://metacpan.org/module/Genealogy::Gedcom::Reader" class="podlinkpod"
>Genealogy::Gedcom::Reader</a>, and can be called from any module.</a></dt>

<dd>
<p>It too will perform some validation on the input tokens, which can come from RAM or a &#39;cooked&#39; file.</p>

<dt><a name="F)_Genealogy::Gedcom::Writer_will_simply_output_the_array_of_tokens,_enabling_round-tripping_of_the_input_stream."
>F) <a href="http://metacpan.org/module/Genealogy::Gedcom::Writer" class="podlinkpod"
>Genealogy::Gedcom::Writer</a> will simply output the array of tokens, enabling round-tripping of the input stream.</a></dt>
</dl>

<p>Later, there will probably be other modules in the series.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Yes,_all_well_and_good,_but_what&#39;s_the_point_of_re-writing_Gedcom.pm?"
>Yes, all well and good, but what&#39;s the point of re-writing Gedcom.pm?</a></h2>

<p>Ahhh - I thought you&#39;d never ask.</p>

<p>The point is that this design minimizes the effort of future support and maintenance.</p>

<p>The DFA takes a State Transition Table as a parameter to new(), and this STT can some from various sources:</p>

<dl>
<dt><a 
>o A copy of the default STT is stored within the source code of <a href="http://metacpan.org/module/Genealogy::Gedcom::Reader::Lexer" class="podlinkpod"
>Genealogy::Gedcom::Reader::Lexer</a>, after the __DATA__ token.</a></dt>

<dd>
<p>This makes it very fast to access (using <a href="http://metacpan.org/module/Data::Section::Simple" class="podlinkpod"
>Data::Section::Simple</a>), and hence this is the default source.</p>

<dt><a name="o_The_STT_can_be_read_in_from_any_CSV_file."
>o The STT can be read in from any CSV file.</a></dt>

<dd>
<dt><a name="o_The_STT_can_be_read_in_from_any_LibreOffice_(nee_Open_Office)_*.ods_file."
>o The STT can be read in from any LibreOffice (nee Open Office) *.ods file.</a></dt>
</dl>

<p>Obviously all forms of the STT have to be in the expected format, which is validated before being used.</p>

<p>You can see a copy of this STT <a href="http://savage.net.au/Perl-modules/html/genealogy/default.stt.html" class="podlinkurl"
>here</a>. The last 2 columns have not been used yet.</p>

<p>The distro ships with scripts/stt2html.pl, which will convert the CSV STT into HTML for easy viewing.</p>

<p>In fact, I work on the STT in LibreOffice, and export it to a CSV file for testing. I can save it as *.ods too obviously. Then the CSV file can be incorporated in the lexer&#39;s source code.</p>

<p>This means anyone can easily experiment with patches to the STT, supporting any extension to GEDCOM they dream up, simply by editing text files.</p>

<p>I should say one reason I love this approach is that after examining the source code for Gedcom.pm, I couldn&#39;t really understand how it performs its magic, and didn&#39;t want to spend too much time studying that technique. I assure you that I in no way mean to disparage Paul&#39;s work: Gedcom.pm is a very cleverly written module, which works very well indeed.</p>

<p>The advantage of my code is the text-based STT combined with the output of an array of lexed and parsed tokens, which anyone can siphon off for their own dark purposes.</p>

<p>Clearly this also means files exported from other genealogy programs can be imported into G::G by judicious editing of the STT.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="Why_do_states_in_that_STT_appear_to_be_doubled?"
>Why do states in that STT appear to be doubled?</a></h2>

<p>Because the design of <a href="http://metacpan.org/module/Set::FA::Element" class="podlinkpod"
>Set::FA::Element</a> demands it.</p>

<p>When text in the input stream is consumed (by matching a regexp in the STT), what happens when the &#39;current&#39; state and the &#39;next&#39; state are the same?</p>

<p><a href="http://metacpan.org/module/Set::FA::Element" class="podlinkpod"
>Set::FA::Element</a> has adopted the convention that such an event is a noop (after the matching input is consumed). That means the DFA does <i>not</i> execute the state&#39;s exit and entry functions, even though that would sometimes convenient. So, in such a situation the STT is designed to rock back and forth between 2 identical states.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="How_do_these_new_modules_handle_non-standard_tags?"
>How do these new modules handle non-standard tags?</a></h2>

<p>Currently, the lexer accepts valid tags which have suffixes. Hence both INDI and INDIVIDUAL are accepted. This will change when validation is implemented.</p>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="What_about_extensions_to_GEDCOM_5.5.1?"
>What about extensions to GEDCOM 5.5.1?</a></h2>

<p>Any extension to the GEDCOM format has to be discussed (if only among Perl programmers), and documented in some manner compatible with the original document.</p>

<p>I have no such suggestions, but I definitely encourage those who do to use the Gedcom mailing list to elicit responses to their ideas.</p>

<p>My code&#39;s design simplifies adoption of such extensions. Other code may be just as easy to extend.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="References"
>References</a></h1>

<dl>
<dt><a name="o_The_original_Perl_Gedcom"
>o The original Perl <a href="http://metacpan.org/module/Gedcom" class="podlinkpod"
>Gedcom</a></a></dt>

<dd>
<dt><a name="o_GEDCOM"
>o GEDCOM</a></dt>

<dd>
<dl>
<dt><a name="o_GEDCOM_Specification"
>o <a href="http://wiki.webtrees.net/File:Ged551-5.pdf" class="podlinkurl"
>GEDCOM Specification</a></a></dt>

<dd>
<dt><a name="o_GEDCOM_Validation"
>o <a href="http://www.tamurajones.net/GEDCOMValidation.xhtml" class="podlinkurl"
>GEDCOM Validation</a></a></dt>

<dd>
<dt><a name="o_GEDCOM_Tags"
>o <a href="http://www.tamurajones.net/GEDCOMTags.xhtml" class="podlinkurl"
>GEDCOM Tags</a></a></dt>
</dl>

<dt><a name="o_Usage_of_non-standard_tags"
>o Usage of non-standard tags</a></dt>

<dd>
<dl>
<dt><a name="o_http://www.tamurajones.net/FTWTEXT.xhtml"
>o <a href="http://www.tamurajones.net/FTWTEXT.xhtml" class="podlinkurl"
>http://www.tamurajones.net/FTWTEXT.xhtml</a></a></dt>

<dd>
<p>This is apparently the worst offender she&#39;s seen. Search that page for &#39;tags&#39;.</p>

<dt><a name="o_http://www.tamurajones.net/GenoPro2011.xhtml"
>o <a href="http://www.tamurajones.net/GenoPro2011.xhtml" class="podlinkurl"
>http://www.tamurajones.net/GenoPro2011.xhtml</a></a></dt>

<dd>
<dt><a name="o_http://www.tamurajones.net/GenoPro2007.xhtml"
>o <a href="http://www.tamurajones.net/GenoPro2007.xhtml" class="podlinkurl"
>http://www.tamurajones.net/GenoPro2007.xhtml</a></a></dt>

<dd>
<dt><a name="o_http://www.tamurajones.net/TheFTWTEXTProblem.xhtml"
>o <a href="http://www.tamurajones.net/TheFTWTEXTProblem.xhtml" class="podlinkurl"
>http://www.tamurajones.net/TheFTWTEXTProblem.xhtml</a></a></dt>
</dl>

<dt><a name="o_Other_articles_on_Tamura&#39;s_site"
>o Other articles on Tamura&#39;s site</a></dt>

<dd>
<dl>
<dt><a name="o_http://www.tamurajones.net/FiveFreakyFeaturesYourGenealogySoftwareShouldNotHave.xhtml"
>o <a href="http://www.tamurajones.net/FiveFreakyFeaturesYourGenealogySoftwareShouldNotHave.xhtml" class="podlinkurl"
>http://www.tamurajones.net/FiveFreakyFeaturesYourGenealogySoftwareShouldNotHave.xhtml</a></a></dt>

<dd>
<dt><a name="o_http://www.tamurajones.net/TwelveOrdinaryMustHaveGenealogySoftwareFeatures.xhtml"
>o <a href="http://www.tamurajones.net/TwelveOrdinaryMustHaveGenealogySoftwareFeatures.xhtml" class="podlinkurl"
>http://www.tamurajones.net/TwelveOrdinaryMustHaveGenealogySoftwareFeatures.xhtml</a></a></dt>
</dl>

<dt><a name="o_Other_projects"
>o Other projects</a></dt>

<dd>
<p>Many of these are discussed on Tamura&#39;s site.</p>

<dl>
<dt><a name="o_http://bettergedcom.wikispaces.com/"
>o <a href="http://bettergedcom.wikispaces.com/" class="podlinkurl"
>http://bettergedcom.wikispaces.com/</a></a></dt>

<dd>
<dt><a name="o_http://www.ngsgenealogy.org/cs/GenTech_Projects"
>o <a href="http://www.ngsgenealogy.org/cs/GenTech_Projects" class="podlinkurl"
>http://www.ngsgenealogy.org/cs/GenTech_Projects</a></a></dt>

<dd>
<dt><a name="o_http://gdmxml.fugal.net/"
>o <a href="http://gdmxml.fugal.net/" class="podlinkurl"
>http://gdmxml.fugal.net/</a></a></dt>

<dd>
<dt><a name="o_http://www.cosoft.org/genxml/"
>o <a href="http://www.cosoft.org/genxml/" class="podlinkurl"
>http://www.cosoft.org/genxml/</a></a></dt>

<dd>
<dt><a name="o_http://www.sunflower.com/~billk/GEDC/"
>o <a href="http://www.sunflower.com/~billk/GEDC/" class="podlinkurl"
>http://www.sunflower.com/~billk/GEDC/</a></a></dt>

<dd>
<dt><a name="o_http://ancestorsnow.blogspot.com/2011/07/vged.html"
>o <a href="http://ancestorsnow.blogspot.com/2011/07/vged.html" class="podlinkurl"
>http://ancestorsnow.blogspot.com/2011/07/vged.html</a></a></dt>

<dd>
<dt><a name="o_http://www.tamurajones.net/GEDCOMValidation.xhtml"
>o <a href="http://www.tamurajones.net/GEDCOMValidation.xhtml" class="podlinkurl"
>http://www.tamurajones.net/GEDCOMValidation.xhtml</a></a></dt>

<dd>
<dt><a name="o_http://webtrees.net/"
>o <a href="http://webtrees.net/" class="podlinkurl"
>http://webtrees.net/</a></a></dt>

<dd>
<dt><a name="o_http://swoodbridge.com/Genealogy/lifelines/"
>o <a href="http://swoodbridge.com/Genealogy/lifelines/" class="podlinkurl"
>http://swoodbridge.com/Genealogy/lifelines/</a></a></dt>

<dd>
<dt><a name="o_http://deadendssoftware.blogspot.com/"
>o <a href="http://deadendssoftware.blogspot.com/" class="podlinkurl"
>http://deadendssoftware.blogspot.com/</a></a></dt>

<dd>
<dt><a name="o_http://www.legacyfamilytree.com/"
>o <a href="http://www.legacyfamilytree.com/" class="podlinkurl"
>http://www.legacyfamilytree.com/</a></a></dt>

<dd>
<dt><a name="o_https://devnet.familysearch.org/docs/api-overview"
>o <a href="https://devnet.familysearch.org/docs/api-overview" class="podlinkurl"
>https://devnet.familysearch.org/docs/api-overview</a></a></dt>
</dl>
</dd>
</dl>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="The_Gedcom_Mailing_List"
>The Gedcom Mailing List</a></h1>

<p>Contact perl-gedcom-help@perl.org.</p>

<!-- end doc -->

</body></html>
